#include "oled_app.h"
#include "oledfont.h"
#include "utc.h"
#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include "ble_gap.h"
#include "nrf_delay.h"
#include "heat_sensor.h"
#include "app_gpio.h"
#include "nrf_log.h"
#include "nrf_log_ctrl.h"
#include "MAX3010x.h"
#include "comm_protocol.h"
#include "ble_salve.h"
#include "stepcounter.h"


/* 电池满点 10*20 */
/**
*点阵格式：阴码
*取模方式：列行式
*取模走向：逆向
**/
const unsigned char BATT_4[] = {
0x00,0x00,0x7F,0x80,0x40,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,
0x5E,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,
0x40,0x80,0x73,0x80,0x1E,0x00,0x00,0x00

};

/* 电池75% 10*20 */
/**
*点阵格式：阴码
*取模方式：列行式
*取模走向：逆向
**/
const unsigned char BATT_3[] = {
0x00,0x00,0x7F,0x80,0x40,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,
0x5E,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,0x40,0x80,0x40,0x80,0x40,0x80,
0x40,0x80,0x73,0x80,0x1E,0x00,0x00,0x00,
};

/* 电池50% 10*20 */
/**
*点阵格式：阴码
*取模方式：列行式
*取模走向：逆向
**/
const unsigned char BATT_2[] = {
0x00,0x00,0x7F,0x80,0x40,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,
0x5E,0x80,0x5E,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,
0x40,0x80,0x73,0x80,0x1E,0x00,0x00,0x00,
};

/* 电池25% 10*20 */
/**
*点阵格式：阴码
*取模方式：列行式
*取模走向：逆向
**/
const unsigned char BATT_1[] = {
0x00,0x00,0x7F,0x80,0x40,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,0x5E,0x80,0x40,0x80,
0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,
0x40,0x80,0x73,0x80,0x1E,0x00,0x00,0x00,
};

/* 电池0% 10*20 */
/**
*点阵格式：阴码
*取模方式：列行式
*取模走向：逆向
**/
const unsigned char BATT_0[] = {
0x00,0x00,0x7F,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,
0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,0x40,0x80,
0x40,0x80,0x73,0x80,0x1E,0x00,0x00,0x00,
};

/* 蓝牙 10*10 */
/**
*点阵格式：阴码
*取模方式：列行式
*取模走向：逆向
**/
const unsigned char BLE[] = {
0x00,0x00,0x21,0x00,0x12,0x00,0x0C,0x00,0x7F,0xC0,0x2A,0x80,0x1B,0x00,0x0A,0x00,
0x00,0x00,0x00,0x00,
};

#ifdef BLE_SCAN
/* 信标图标 10*10 */
/**
*点阵格式：阴码
*取模方式：列行式
*取模走向：逆向
**/
const unsigned char Beacon[] = {
0x3E,0x00,0x49,0x00,0xBE,0x80,0xAA,0x80,0xFF,0x80,0xAA,0x80,0xBE,0x80,0x49,0x00,
0x3E,0x00,0x00,0x00
};
#endif

/* 计步 40*26 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char STEP[] = {
0x01,0x80,0x00,0x00,0x01,0xC0,0x00,0x00,0x0E,0x80,0x00,0x00,0x0E,0x7F,0xC0,0x00,
0x06,0xFF,0xF0,0x00,0x19,0xFF,0xFC,0x00,0x3D,0xFF,0xFE,0x00,0x1B,0xFF,0xFF,0x00,
0x03,0xFF,0xFF,0x80,0x3B,0xFF,0xFF,0xC0,0x7B,0xFF,0xFF,0xC0,0x33,0xFE,0x1F,0xC0,
0x03,0xFC,0x0F,0xC0,0x7B,0xFC,0x07,0x80,0xFD,0xF8,0x03,0x80,0xFC,0x70,0x00,0x00,
0xFC,0x00,0x00,0x00,0x78,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x00,0x00,0x00,0xFC,0x00,0x00,0x00,
0xFC,0x70,0x00,0x00,0xFD,0xF8,0x03,0x80,0x7B,0xFC,0x07,0x80,0x03,0xFC,0x0F,0xC0,
0x33,0xFE,0x1F,0xC0,0x7B,0xFF,0xFF,0xC0,0x3B,0xFF,0xFF,0xC0,0x03,0xFF,0xFF,0x80,
0x1B,0xFF,0xFF,0x00,0x3D,0xFF,0xFE,0x00,0x19,0xFF,0xFC,0x00,0x06,0xFF,0xF0,0x00,
0x0E,0x7F,0xC0,0x00,0x0E,0x80,0x00,0x00,0x01,0xC0,0x00,0x00,0x01,0x80,0x00,0x00

};

/* 距离 26*26*/
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char Distance[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xC0,
0x03,0xF8,0x00,0x40,0x0F,0xFC,0x00,0x40,0x1F,0xFF,0x00,0x40,0x3F,0xFF,0x80,0x40,
0x3F,0xFF,0xC0,0x40,0x7E,0x1F,0xE0,0x40,0x7C,0x07,0xF0,0x40,0xF8,0x07,0xF8,0x40,
0xF8,0x03,0xFC,0x40,0xF8,0x03,0xFC,0x40,0xF8,0x07,0xF8,0x40,0xFC,0x07,0xF0,0x40,
0x7E,0x0F,0xE0,0x40,0x7F,0xFF,0xC0,0x40,0x3F,0xFF,0x80,0x40,0x1F,0xFF,0x00,0x40,
0x0F,0xFC,0x00,0x40,0x03,0xF8,0x00,0x40,0x00,0x00,0x01,0xC0,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

/* 热量 35*30*/
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char Calorie[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x00,
0x00,0x03,0xFF,0x00,0x00,0x0F,0xFF,0xC0,0x00,0x3F,0xFF,0xE0,0x00,0x7F,0xFF,0xF0,
0x00,0x0F,0xFF,0xF0,0x00,0x07,0xFF,0xF8,0x00,0x07,0xFC,0x38,0x00,0x03,0xF8,0x1C,
0x00,0x03,0xF8,0x1C,0x00,0x07,0xF8,0x1C,0x00,0x0F,0xF8,0x1C,0x40,0x7F,0xF0,0x1C,
0x3F,0xFF,0xF0,0x18,0x1F,0xFF,0xE0,0x38,0x0F,0xFF,0xC0,0x78,0x07,0xFF,0x87,0xF0,
0x01,0xFF,0xFF,0xF0,0x00,0xFF,0xFF,0xE0,0x00,0x3F,0xFF,0xC0,0x00,0x07,0xFF,0x00,
0x00,0x00,0x78,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

/* 心率 26*21 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char HEARTBATE_BIG[] ={
0x00,0x00,0x00,0x07,0x00,0x00,0x1F,0xC0,0x00,0x3F,0xF0,0x00,0x7F,0xF8,0x00,0x7F,
0xFC,0x00,0x7F,0xFE,0x00,0x7F,0xFF,0x00,0x7F,0xFF,0x80,0x7F,0xFF,0xC0,0x7F,0xFF,
0xE0,0x3F,0xFF,0xF0,0x3F,0xFF,0xF8,0x1F,0xFF,0xF8,0x3F,0xFF,0xF8,0x3F,0xFF,0xF0,
0x7F,0xFF,0xE0,0x7F,0xFF,0xC0,0x7F,0xFF,0x80,0x7F,0xFF,0x00,0x7F,0xFE,0x00,0x7F,
0xFC,0x00,0x7F,0xF8,0x00,0x3F,0xF0,0x00,0x1F,0xC0,0x00,0x07,0x00,0x00,
};

/* 心率 8*14 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char HEARTBATE_LITTLE[]={
0x00,0x00,0x1C,0x00,0x3F,0x00,0x7F,0x80,0x7F,0xC0,0x7F,0xE0,0x7F,0xF0,0x7F,0xF8,
0x3F,0xFC,0x3F,0xFC,0x3F,0xFC,0x7F,0xF8,0x7F,0xF0,0x7F,0xE0,0x7F,0xC0,0x7F,0x80,
0x3F,0x00,0x1C,0x00,
};

/* 血氧30*30 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char OXYGEN_1[]={
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xF8,0x00,0x00,0x1F,0xFE,0x00,
0x00,0x3F,0x1F,0x80,0x00,0xF8,0x03,0xC0,0x01,0xE0,0x01,0xC0,0x03,0xC0,0x00,0xE0,
0x07,0x00,0x00,0x70,0x0E,0x00,0x00,0x70,0x1C,0x00,0x00,0x30,0x38,0x00,0x00,0x30,
0x70,0x00,0x00,0x30,0x78,0x00,0x00,0x00,0x38,0x00,0x3F,0xC0,0x1C,0x00,0x7F,0xE0,
0x0E,0x00,0x60,0x20,0x07,0x00,0xC0,0x30,0x03,0xC0,0xC0,0x30,0x01,0xE0,0xC0,0x30,
0x00,0xF8,0x60,0x60,0x00,0x3E,0x7F,0xE0,0x00,0x1E,0x3F,0x80,0x00,0x00,0x06,0x18,
0x00,0x00,0x04,0x38,0x00,0x00,0x04,0x68,0x00,0x00,0x06,0xC8,0x00,0x00,0x03,0x98,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

/* 血氧30*30 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char OXYGEN_2[]={
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xF8,0x00,0x00,0x1F,0xFE,0x00,
0x00,0x3F,0x1F,0x80,0x00,0xF8,0x03,0xC0,0x01,0xE0,0x01,0xC0,0x03,0xC0,0x00,0xE0,
0x07,0x00,0x00,0x70,0x0E,0x00,0x00,0x70,0x1C,0x00,0x00,0x30,0x38,0x00,0x00,0x30,
0x70,0x00,0x00,0x30,0x78,0x00,0x00,0x30,0x38,0x00,0x00,0x30,0x1C,0x00,0x00,0x30,
0x0E,0x00,0x00,0x30,0x07,0x00,0x00,0x70,0x03,0xC0,0x00,0xE0,0x01,0xE0,0x00,0xE0,
0x00,0xF8,0x03,0xC0,0x00,0x3E,0x3F,0x80,0x00,0x1F,0xFE,0x00,0x00,0x03,0xF8,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};


/* 温度 30*30*/
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char TEMPER[]={
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x1A,0x12,0x07,0x00,0x1A,0xD2,0x1F,0xC0,0x00,0x00,0x3F,0xF0,0x00,0x00,0x70,0x70,
0x7F,0xFF,0xE0,0x38,0x7F,0xFF,0xC0,0x1C,0xF8,0x00,0x00,0x0C,0xF8,0x00,0x00,0x0C,
0xF8,0x00,0x00,0x0C,0x7F,0xFF,0xE0,0x1C,0x3F,0xFF,0xE0,0x18,0x00,0x00,0x78,0x38,
0x00,0x00,0x3F,0xF0,0x00,0x00,0x1F,0xC0,0x00,0x00,0x07,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

/* 温度单位℃ 16*16 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char DEGREE[]={
0x00,0x00,0x38,0x00,0x44,0x00,0x44,0x00,0x44,0x00,0x38,0x00,0x00,0x00,0x1F,0xF8,
0x3F,0xFC,0x30,0x0C,0x30,0x0C,0x3C,0x1C,0x1C,0x18,0x00,0x00,0x00,0x00,0x00,0x00
};

/* 闹钟℃ 40*38 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char ALARM[]={
0x07,0xC0,0x00,0x00,0x00,0x0F,0xE0,0x00,0x00,0x00,0x3F,0xC0,0xFF,0x00,0x00,0x3F,
0x87,0xFF,0xE0,0x00,0x7E,0x1F,0xFF,0xF8,0x18,0x7C,0x7E,0x00,0x7C,0x3C,0xF8,0xF0,
0x00,0x1F,0x78,0xF1,0xE0,0x00,0x07,0xF0,0xF3,0xC0,0x00,0x03,0xE0,0x63,0x80,0x00,
0x01,0xE0,0x67,0x00,0x00,0x00,0xE0,0x0E,0x00,0x00,0x00,0x70,0x0E,0x00,0x00,0x00,
0x70,0x1C,0x00,0x00,0x00,0x38,0x1C,0x00,0x00,0x00,0x38,0x18,0x00,0x00,0x00,0x18,
0x38,0x00,0x00,0x00,0x18,0x38,0x00,0x00,0x00,0x18,0x38,0x7F,0xF8,0x00,0x1C,0x38,
0xFF,0xF8,0x00,0x1C,0x38,0xFF,0xFC,0x00,0x1C,0x38,0x7F,0xFC,0x00,0x18,0x38,0x00,
0x3C,0x00,0x18,0x38,0x00,0x3C,0x00,0x18,0x18,0x00,0x3C,0x00,0x18,0x1C,0x00,0x3C,
0x00,0x38,0x1C,0x00,0x3C,0x00,0x30,0x0C,0x00,0x3C,0x00,0x30,0x0E,0x00,0x38,0x00,
0x70,0x67,0x00,0x00,0x00,0xE0,0x67,0x80,0x00,0x01,0xE0,0xE3,0xC0,0x00,0x03,0xE0,
0xF1,0xE0,0x00,0x07,0xF0,0xF8,0xF0,0x00,0x0F,0x78,0x7C,0x7C,0x00,0x3E,0x3C,0x7E,
0x3F,0xC1,0xF8,0x1C,0x7F,0x0F,0xFF,0xE0,0x00,0x3F,0x81,0xFF,0x80,0x00,0x1F,0xE0,
0x00,0x00,0x00,0x0F,0xC0,0x00,0x00,0x00
};

/* 血压 40*24 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char BLOOD[]={
0x78,0x00,0x00,0xFE,0x00,0xF0,0xC7,0x03,0xFC,0x83,0xFF,0x0F,0x93,0xFC,0x03,0x83,
0x00,0x03,0xC6,0x03,0xE3,0xFC,0x07,0xF3,0x78,0x06,0x1B,0x00,0x36,0x0F,0x00,0x7E,
0x06,0x00,0x7E,0x06,0x00,0xFF,0x0C,0x01,0xFF,0xFC,0x03,0xFF,0xF0,0x03,0xFF,0xE0,
0x07,0xFF,0xC0,0x01,0xFF,0xC0,0x00,0xFF,0x80,0x00,0x7F,0x00,0x00,0x7E,0x1E,0x00,
0xC0,0x3E,0x00,0xC0,0x3E,0x00,0xC0,0x3E,0x00,0xC0,0x3C,0x00,0xC0,0x70,0x00,0x61,
0xE0,0x00,0x3F,0x80,0x00,0x1E,0x00,0x00,0x00,0x00,
};

/* M 10*16 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char M[] = {
0xFF,0xFF,0xFF,0xFF,0x7F,0x00,0x07,0xC0,0x00,0xF0,0x00,0xF0,0x07,0xC0,0x3F,0x00,
0xFF,0xFF,0xFF,0xFF
};

/* A 9*16 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char A[] = {
0x00,0x1F,0x03,0xFF,0x3F,0xF0,0x78,0x30,0xC0,0x30,0x78,0x30,0x3F,0xF0,0x03,0xFF,
0x00,0x1F
};

/* C 9*16 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char C[] = {
0x3F,0xFC,0x7F,0xFE,0xC0,0x03,0xC0,0x03,0xE0,0x07,0x70,0x0E,0x00,0x00
};

/* 手机采集图标32*32 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char Collect_0[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x1F,0xFF,0x90,
0x00,0x1F,0xFF,0x90,0x00,0x18,0x01,0x90,0x00,0x18,0x01,0x90,0x00,0x18,0x01,0x90,
0x00,0x1F,0xFF,0x90,0x00,0x1F,0xFF,0x90,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x0F,0xFF,0xFF,0x90,0x0F,0xFF,0xFF,0x90,0x0C,0x00,0x01,0x90,
0x0C,0x00,0x01,0x90,0x0C,0x00,0x01,0x90,0x0F,0xFF,0xFF,0x90,0x0F,0xFF,0xFF,0x90,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0xFF,0x90,0x00,0x00,0xFF,0x90,
0x00,0x00,0xC1,0x90,0x00,0x00,0xC1,0x90,0x00,0x00,0xC1,0x90,0x00,0x00,0xFF,0x90,
0x00,0x00,0xFF,0x90,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

/* 手机采集图标32*32 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char Collect_1[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x1F,0xFF,0x90,
0x00,0x1F,0xFF,0x90,0x00,0x18,0x01,0x90,0x00,0x18,0x01,0x90,0x00,0x18,0x01,0x90,
0x00,0x1F,0xFF,0x90,0x00,0x1F,0xFF,0x90,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};

/* 手机采集图标32*32 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char Collect_2[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x0F,0xFF,0xFF,0x90,0x0F,0xFF,0xFF,0x90,0x0C,0x00,0x01,0x90,
0x0C,0x00,0x01,0x90,0x0C,0x00,0x01,0x90,0x0F,0xFF,0xFF,0x90,0x0F,0xFF,0xFF,0x90,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

/* 手机采集图标32*32 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char Collect_3[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,
0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x10,0x00,0x00,0xFF,0x90,0x00,0x00,0xFF,0x90,
0x00,0x00,0xC1,0x90,0x00,0x00,0xC1,0x90,0x00,0x00,0xC1,0x90,0x00,0x00,0xFF,0x90,
0x00,0x00,0xFF,0x90,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

/* 蓝牙连接32*32 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char BLE_Connect[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x01,0xC0,0x03,0x80,0x03,0xE0,0x07,0xC0,0x03,0xF0,0x0F,0xC0,0x01,0xF8,0x1F,0x80,
0x00,0xFC,0x3F,0x00,0x00,0x7E,0x7E,0x00,0x00,0x3F,0xFC,0x00,0x00,0x1F,0xF8,0x00,
0x3F,0xFF,0xFF,0xFC,0x3F,0xFF,0xFF,0xFC,0x1F,0xFF,0xFF,0xF8,0x0F,0x9F,0xF9,0xF0,
0x07,0x9F,0xF9,0xE0,0x03,0xFE,0x7F,0xC0,0x01,0xFC,0x3F,0x80,0x00,0xF9,0x9F,0x00,
0x00,0x73,0xCE,0x00,0x00,0x07,0xE0,0x00,0x00,0x07,0xE0,0x00,0x00,0x03,0x80,0x00,
0x00,0x60,0x06,0x00,0x00,0x70,0x0E,0x00,0x00,0x3F,0xFE,0x00,0x00,0x1F,0xF8,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

/* 蓝牙断开32*32 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char BLE_Disconnect[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x03,0x80,0x01,0x00,
0x01,0xC0,0x03,0x80,0x00,0xE0,0x07,0x00,0x00,0x70,0x0E,0x00,0x00,0x38,0x1C,0x00,
0x00,0x1C,0x38,0x00,0x00,0x0E,0x70,0x00,0x00,0x07,0xF0,0x00,0x1F,0xC3,0xFF,0xF8,
0x1F,0xE1,0xFF,0xF8,0x0F,0x00,0xF0,0xF0,0x07,0x88,0x71,0xE0,0x03,0xDC,0x3B,0xC0,
0x01,0xFC,0x1F,0x80,0x00,0xF8,0x0F,0x00,0x00,0x70,0x07,0x00,0x00,0x00,0x03,0x80,
0x00,0x00,0x01,0xC0,0x00,0x00,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

#ifdef BLE_SCAN
/* 信标丢失失32*32 */
/**
*点阵格式：阴码
*取模方式：逐行式
*取模走向：顺向
**/
const unsigned char Beacon_lost[] = {
0x00,0x3F,0xFF,0x80,0x00,0xFF,0xFF,0xC0,0x00,0xFF,0xFF,0xE0,0x01,0xFF,0xFF,0xE0,
0x01,0xFF,0xFF,0xE0,0x01,0xFF,0xFF,0xE0,0x01,0xFF,0xFF,0xE0,0x7F,0x80,0x00,0x60,
0xFF,0x80,0x00,0x60,0xC1,0xFF,0xFF,0xE0,0xC1,0xFF,0xFF,0xE0,0xC1,0xFF,0xFF,0xE0,
0xC1,0xFF,0xFF,0xE0,0xC1,0xFF,0xFF,0xE0,0xC1,0xFF,0xFF,0xE0,0xC1,0xFF,0xFF,0xE0,
0xC1,0xFF,0xFF,0xE0,0xC1,0xFF,0xFF,0xE0,0xC1,0xFF,0xFF,0x80,0xC1,0xFF,0xFC,0x00,
0xFF,0x80,0x00,0x00,0x7F,0x80,0x03,0xE0,0x01,0xFF,0xE7,0xF0,0x01,0xFF,0xEE,0x38,
0x01,0xFF,0xCC,0x18,0x01,0xFF,0xCC,0x18,0x00,0xFF,0xCC,0x18,0x00,0xFF,0xCE,0x38,
0x00,0x3F,0xC7,0xF8,0x00,0x00,0x03,0xFC,0x00,0x00,0x00,0x0E,0x00,0x00,0x00,0x00
};
#endif


/* OLED显示控制 */
oled_ctrl_t OLED_ctrl = {
     .oled_state_flag    = OLED_CLOSE_DISEN,              //当前屏幕是灭
	   .oled_off_key       = OLED_ON,                     //可以倒计时熄灭屏幕
	   .time_off           = OLED_OFF_TIME,               //倒计时时间为10s
	   .lastPageOledState  = OLED_OFF,
	   .lastPageNum        = DATE_P,             
	   .page_num           = DATE_P,                      //当前在日期页
};


MAX3010x_Data_t Save_heart_sensor_data;  //保留上次获取的心率血压数据，用于广播

/**********************************************************************
函数名:SetLastPageInfo
功能:设置上一个页面的信息
输入参数：
@page:需要跳转的页面
@state:页面状态，亮屏还是熄灭
@closeSwitch:息屏开关。能否息屏
@closeTime:亮屏时间
输出参数:None
返回值:None
说明:
***********************************************************************/
void SetLastPageInfo(const page_e page, const int8_t state, const int8_t closeSwitch, const int8_t closeTime)
{
     OLED_ctrl.lastPageNum       = page;
     OLED_ctrl.lastPageOledState = state;
     OLED_ctrl.lastPageKey       = closeSwitch;
     OLED_ctrl.lastPageTime      = closeTime;	
}

/**********************************************************************
函数名:SetNewPageInfo
功能:设置当前页面的信息
输入参数：
@page:需要跳转的页面
@state:页面状态，亮屏还是熄灭
@closeSwitch:息屏开关。能否息屏
@closeTime:亮屏时间
输出参数:None
返回值:None
说明:
***********************************************************************/
void SetNewPageInfo(const page_e page, const int8_t state, const int8_t closeSwitch, const int8_t closeTime)
{
    OLED_ctrl.page_num           = page;
    OLED_ctrl.oled_state_flag    = state;
    OLED_ctrl.oled_off_key       = closeSwitch;
    OLED_ctrl.time_off           = closeTime;	
}

/**********************************************************************
函数名:JumpPage
功能:页面跳转,刚跳转的时候刷新页面
输入参数：None
输出参数:None
返回值:None
说明:
***********************************************************************/
void JumpPage(void)
{
     switch(OLED_ctrl.page_num){
			 case DATE_P:      //日期页面         
			 {
			      UTCTime_t tm;
	          GetClock_UTC(&tm);                                              //获取实时时间
				    
#ifdef BLE_SCAN
            OLEDE_dispaly_date(&tm, sys_state.Beacon_scan_state ,sys_state.ble_connect_state,sys_state.batty_grabe);  //显示															
#else
						OLEDE_dispaly_date(&tm,sys_state.ble_connect_state,sys_state.batty_grabe);  //显示
#endif
			 }
			 break;
	     
			 case STEP_P:         //步数页面         
			 {
			       OLEDE_dispaly_step(movement.stepcount);              //显示步数
			 }
		   break;
			 
	     case DISTANCE_P:      //行走的距离页面 
			 {
			      OLEDE_dispaly_Distance(movement.distance);            //显示距离
			 }				 
		   break;
			 
	     case CALORIE_P:       //热量界面   
			 {
			      OLEDE_dispaly_Calorie(movement.calorie);              //显示
			 }				 
		   break;
			 
	     case HEART_P:         //心率界面 
			 {
						OLEDE_dispaly_HeartRate(max30102_data.Heart);         //显示距离
				    timers_start_Max30102_timer();                        //开启采集
			 }				 
		   break;
			 
	     case OXYGEN_P:        //血氧界面
			 {
						OLEDE_dispaly_Oxygen(max30102_data.SpO2);              //显示距离
				    timers_start_Max30102_timer();                         //开启采集
			 }         
		   break;
			 
	     case TEMPER_P:        //温度界面 
			 {
						OLEDE_dispaly_Temperature( max30102_data.Temper);       //显示
				    timers_start_Max30102_timer();                          //开启采集
			 }				 
		   break;
			 
	     case MAC_P:           //MAC地址界面
			 {
				    timers_stop_Max30102_timer();                          //关闭传感器数据采集
			      OLEDE_dispaly_mac();                                    //显示
			 }				 
		   break;
			 
	     case ALARM_P:         //闹钟界面
			 {
			     OLEDE_dispaly_alarm();
			 }         
		   break;
			 
	     case COLLECT_P:       //手机采集页面
			 {
			     OLEDE_dispaly_Phone_Collect();
			 }				 
		   break;
			 
	     case BLE_CONNECT_P:   //蓝牙连接 
			 {
			     OLEDE_dispaly_BLE_Connect(1);
			 }				 
		   break;
			 
	     case BLE_DISCONNECT_P://蓝牙断开连接
			 {
			     OLEDE_dispaly_BLE_Disconnect();
			 }				 
		   break;
			 
#ifdef BLE_SCAN
	     case BEACON_LOST_P:   //信标丢失
			 {
			     OLEDE_dispaly_BeaconLost();
			 }         
		   break;
#endif
		 }    
}


/**********************************************************************
函数名:OLED_Change_Display
功能:改变页面和动态刷新页面
输入参数：
@tm:时间日期
输出参数:None
返回值:None
说明:
***********************************************************************/
void OLED_Change_Display(const UTCTime_t *tm)
{
		 /*************************************** 控制LED显示的页面切换和闪烁 ************************************************/
	   if(OLED_ctrl.oled_state_flag == 1)         //当前屏幕是亮的，可以显示内容
	   {
         switch((uint8_t)(OLED_ctrl.page_num))              //当前显示第几页    
         {
             /*********************************日期***************************************/
						 case DATE_P:      
						 {
#ifdef BLE_SCAN
							   OLEDE_dispaly_date(tm, sys_state.Beacon_scan_state ,sys_state.ble_connect_state, sys_state.batty_grabe);	     //每1s刷新一次数据		 
#else
						     OLEDE_dispaly_date(tm, sys_state.ble_connect_state, sys_state.batty_grabe);	     //每1s刷新一次数据		
#endif							 
						 }
						 break;
														
						 /*********************************步数***************************************/
	           case STEP_P:    
             {
						      OLEDE_dispaly_step(movement.stepcount);              //显示步数							
						 }
       			 break;
														
             /*********************************距离***************************************/														
	           case DISTANCE_P: 
						 {
						     OLEDE_dispaly_Distance(movement.distance);            //显示距离								
						 }
 						 break;
														
						 /*********************************热量***************************************/	
	           case CALORIE_P:
             {
							   OLEDE_dispaly_Calorie(movement.calorie);               //显示							
						 }		
             break;
														
						 /*********************************心率***************************************/
	           case HEART_P:         
						 {
							   if(  max30102_data.Heart < 0 )
							       max30102_data.Heart ++;
						     OLEDE_dispaly_HeartRate(max30102_data.Heart);							
						 }
						 break;
														
						 /*********************************血氧***************************************/
	           case OXYGEN_P:       
						 {
							  if( max30102_data.SpO2 < 0 )
								    max30102_data.SpO2++;
								
						    OLEDE_dispaly_Oxygen( max30102_data.SpO2);							
						 }
						 break;
														
						 /*********************************温度***************************************/
	           case TEMPER_P:        
						 {
							   if(  max30102_data.Temper < 0 )
								     max30102_data.Temper++;
						     OLEDE_dispaly_Temperature(max30102_data.Temper);							
						 }
						 break;  
            
						  /*********************************闹钟***************************************/
             case ALARM_P:		
             {
						      /* 开启振动 */
				          Motor_Drive();
						 }
             break;					

             /*********************************手机采集***************************************/
             case COLLECT_P:		
             {
						     OLEDE_dispaly_Phone_Collect();
						 }
             break;	

						  /*********************************蓝牙连接***************************************/
             case BLE_CONNECT_P:
             {
						     OLEDE_dispaly_BLE_Connect(0);
						 }
             break;			

             /*********************************蓝牙断开连接***************************************/
             case BLE_DISCONNECT_P:
             {
						     OLEDE_dispaly_BLE_Disconnect();
						 }
             break;		
#ifdef BLE_SCAN
             /*********************************Beacon扫描***************************************/
             case BEACON_LOST_P:
             {
						     OLEDE_dispaly_BeaconLost();
						 }
             break;		
#endif						 
		     }
	   } 
		 /* 即使是在息屏页面。有一些操作还是需要进行。比如手机连续采集 */
     else     //屏幕是熄灭的
     {
		     switch((uint8_t)(OLED_ctrl.page_num))              //当前显示第几页    
				 {
				     /*********************************手机采集***************************************/
             case COLLECT_P:		
             {
							 OLEDE_dispaly_Phone_Collect();   //在息屏的时候可以调用该函数。显示数据会发送给屏幕，只是屏幕是关闭的，不显示。
						 }
             break;	    
				 }					 
		 }	
      
		 /*************************************** 控制LED显示的亮屏时间和是否息屏 *********************************************/
	   if(OLED_ctrl.oled_off_key == OLED_CLOSE_EN)            //如果开启息屏倒计时
	   { 
           OLED_ctrl.time_off--;                            //息屏倒计时--
		       if(OLED_ctrl.time_off == 0)                      //倒计时时间到，关闭显示
		       {
						    /* 如果是从信标丢失页面或者蓝牙断开页面返回。则需要返回到开始的状态。*/
						    if( OLED_ctrl.page_num == BEACON_LOST_P || OLED_ctrl.page_num == BLE_DISCONNECT_P || OLED_ctrl.page_num == ALARM_P)       
								{
			             SetNewPageInfo(OLED_ctrl.lastPageNum, OLED_ctrl.lastPageOledState, OLED_ctrl.lastPageKey, OLED_ctrl.lastPageTime);  //恢复之前的页面，此处不需要跳转								
								}
								else     //关闭显示
								{
								    OLED_Display_Off();                               //关闭显示
			              OLED_ctrl.oled_off_key    = OLED_CLOSE_DISEN;     //标记不可倒计时熄灭屏幕   
			              OLED_ctrl.oled_state_flag = OLED_OFF;             //标记当前屏幕是熄灭的
									
                    if( OLED_ctrl.page_num != COLLECT_P )	          //如果当前页面不是在采集页面。息屏后将设置页面为日期页面										
										    OLED_ctrl.page_num = DATE_P;                //息屏了就将页面恢复到日期页面  											
								}
		       }
	   } 
		 
}

#ifdef BLE_SCAN
/**********************************************************************
函数名:OLEDE_dispaly_date
功能:显示时间和连接状态
输入参数：
@tm:时间日期
@connect_state:连接状态
@scan_state:扫描状态
@batty:电量等级 1:1格        2:2格   3:三格    4:4格  0：0格
输出参数:None
返回值:None
说明:
***********************************************************************/
void OLEDE_dispaly_date(const UTCTime_t *tm, const uint8_t scan_state, const uint8_t connect_state, const uint8_t batty)
{
    char buff[10] = {0};
		
    OLED_Clear();

   
    /* 显示电量 */
    switch(batty)
    {
        case 0:
            OLED_DrawBMP(44,1,64,10,BATT_0,sizeof(BATT_0),1);
		      break;
		
        case 1:
            OLED_DrawBMP(44,1,64,10,BATT_1,sizeof(BATT_1),1);
		      break;
		
		      case 2:
            OLED_DrawBMP(44,1,64,10,BATT_2,sizeof(BATT_2),1);
		      break;
		
		      case 3:
            OLED_DrawBMP(44,1,64,10,BATT_3,sizeof(BATT_3),1);
		      break;

		      case 4:
            OLED_DrawBMP(44,1,64,10,BATT_4,sizeof(BATT_4),1);
		      break;
		
  	 }
    
	   /* 显示时间 */
	   memset(buff,0,sizeof(buff));
	   if(tm->second%2 == 0)
		 {
	      sprintf(buff,"%02d:%02d",tm->hour,tm->minute);
			  
			 /* 显示连接状态 */
       if(connect_state == 1)         //如果蓝牙连接，显示蓝牙图标
           OLED_DrawBMP(32,1,42,11,BLE,sizeof(BLE),1);
			 else if( scan_state == 1 )     //如果蓝牙为连接，信标在线，显示信标图像
			     OLED_DrawBMP(32,1,42,11,Beacon,sizeof(Beacon),1);
	      
		 }
	   else
		 {
		     sprintf(buff,"%02d %02d",tm->hour,tm->minute);
			   
			   /* 显示信标状态 */
			   if(scan_state == 1)          //如果信标在线，显示信标图标
			       OLED_DrawBMP(32,1,42,11,Beacon,sizeof(Beacon),1);
				 else if(connect_state == 1)  //如果信标不在线，蓝牙在线，显示蓝牙图标
             OLED_DrawBMP(32,1,42,11,BLE,sizeof(BLE),1);
		 }
	
    OLED_ShowString(6,16,buff,32,1);

	   /* 显示日期 */
	   memset(buff,0,sizeof(buff));
	   sprintf(buff,"%02d-%02d",tm->month+1,tm->day+1);
       OLED_ShowString(0,2,buff,12,1);

	   OLED_Refresh_Gram();   //刷新显示
}
#else
/**********************************************************************
函数名:OLEDE_dispaly_date
功能:显示时间和连接状态
输入参数：
@tm:时间日期
@state:连接状态  1；连接
@batty:电量等级 1:1格        2:2格   3:三格    4:4格  0：0格
输出参数:None
返回值:None
说明:
***********************************************************************/
void OLEDE_dispaly_date(const UTCTime_t *tm, const uint8_t state, const uint8_t batty)
{
    char buff[10] = {0};
	
    OLED_Clear();

    /* 显示连接状态 */
    if(state == 1)
        OLED_DrawBMP(32,1,42,11,BLE,sizeof(BLE),1);
    /* 显示电量 */
    switch(batty)
    {
        case 0:
            OLED_DrawBMP(44,1,64,10,BATT_0,sizeof(BATT_0),1);
		      break;
		
        case 1:
            OLED_DrawBMP(44,1,64,10,BATT_1,sizeof(BATT_1),1);
		      break;
		
		      case 2:
            OLED_DrawBMP(44,1,64,10,BATT_2,sizeof(BATT_2),1);
		      break;
		
		      case 3:
            OLED_DrawBMP(44,1,64,10,BATT_3,sizeof(BATT_3),1);
		      break;

		      case 4:
            OLED_DrawBMP(44,1,64,10,BATT_4,sizeof(BATT_4),1);
		      break;
		
  	 }
    
	   /* 显示时间 */
	   memset(buff,0,sizeof(buff));
	   if(tm->second%2 == 0)
	      sprintf(buff,"%02d:%02d",tm->hour,tm->minute);
	   else
		     sprintf(buff,"%02d %02d",tm->hour,tm->minute);
	
    OLED_ShowString(6,16,buff,32,1);

	   /* 显示日期 */
	   memset(buff,0,sizeof(buff));
	   sprintf(buff,"%02d-%02d",tm->month+1,tm->day+1);
       OLED_ShowString(0,2,buff,12,1);

	   OLED_Refresh_Gram();   //刷新显示
}
#endif

/**********************************************************************
函数名:OLEDE_dispaly_step
功能:显示步数
输入参数：
@step_num:步数
输出参数:None
返回值:None
说明:
***********************************************************************/
void OLEDE_dispaly_step(uint32_t step_num)
{
     OLED_Clear();    

     /* 填充图标 */
      OLED_DrawBMP(13,1,64,27,STEP,sizeof(STEP),1);
	 
	    /* 填充数据 */
	    if(step_num >= 10000)	
	        OLED_ShowNum(14,30,step_num,5,16);
	    else if(step_num >= 1000)
	 	      OLED_ShowNum(18,30,step_num,4,16);
	    else if(step_num >= 100)
	 	      OLED_ShowNum(22,30,step_num,3,16);
	    else if(step_num >= 10)
	 	      OLED_ShowNum(26,30,step_num,2,16);
	    else
	        OLED_ShowNum(30,30,step_num,1,16);
	 
     OLED_Refresh_Gram();   //刷新显示
}

/**********************************************************************
函数名:OLEDE_dispaly_Distance
功能:显示行走的距离
输入参数：
@distance:行走的距离，(km*10)
输出参数:None
返回值:None
说明:
***********************************************************************/
void OLEDE_dispaly_Distance(uint32_t distance)
{
	   char buff[10];
     OLED_Clear(); 
 	
     /* 填充图片 */
	   OLED_DrawBMP(18,1,63,31,Distance,sizeof(Distance),1);
	
	   /* 填充数字 */
	  sprintf(buff,"%d.%d",distance/10, distance%10);
	  if( distance > 100 )     //三位数显示
		{
		    OLED_ShowString(16,30,buff,16,1);
		}
		else
		{ 
	      OLED_ShowString(20,30,buff,16,1);
		}
	 
		//显示单位
		OLED_ShowString(48,36,"km",12,1);
     OLED_Refresh_Gram();   //刷新显示
}

/**********************************************************************
函数名:OLEDE_dispaly_Calorie
功能:显示消耗的卡路里
输入参数：
@Cal:热量(cal)
输出参数:None
返回值:None
说明:
    根据行走的距离计算消耗的热量
***********************************************************************/
void OLEDE_dispaly_Calorie(uint32_t Cal)
{
     char buff[10];
     OLED_Clear(); 
 	

     /* 填充图片 */
	   OLED_DrawBMP(14,1,63,31,Calorie,sizeof(Calorie),1);
	
	   /* 填充数字 */
	  sprintf(buff,"%d.%d",Cal/10, Cal%10);
	
		if( Cal > 1000 )
		     OLED_ShowString(0,32,buff,16,1);	
	  else if( Cal > 100 )     
		    OLED_ShowString(8,32,buff,16,1);
		else if( Cal > 10 )
		     OLED_ShowString(16,32,buff,16,1);	
		else
	      OLED_ShowString(16,32,buff,16,1);
	 
		//显示单位
		OLED_ShowString(40,36,"Kcal",12,1);
		
    OLED_Refresh_Gram();   //刷新显示
}

/**********************************************************************
函数名:OLEDE_dispaly_HeartRate
功能:显示心率
输入参数：
@heart_num:心率
输出参数:None
返回值:None
说明:
heart_num < 0,表示心率采集准备，倒计时
heart_num = 0,表示正在采集
***********************************************************************/
void OLEDE_dispaly_HeartRate(s16 heart_num)
{
    static uint8_t flag = 0;      //控制显示大心和小心的闪烁
	
    OLED_Clear();    
    if( heart_num < 0 )           //准备开始采集
		{
		    /* 显示大心和倒计时 */
			  OLED_DrawBMP(18,4,63,25,HEARTBATE_BIG,sizeof(HEARTBATE_BIG),1);
			  OLED_ShowNum(29,30,abs(heart_num),1,12); 
			
			  if( abs(heart_num) <= 2 )     //从倒计时2S时开始采集数据
				{
					  flag = 0;
			      //开始计算心率血氧值
			      Get_Heart_Oxygen(1);
				}
		}
		else if( heart_num == 0 )     //采集中
		{
			  //开始计算心率血氧值
			   Get_Heart_Oxygen(0);		 
			
		    if( flag == 0 )           //显示大心
				{
				    OLED_DrawBMP(18,4,63,25,HEARTBATE_BIG,sizeof(HEARTBATE_BIG),1);
					  flag = 1;
				}
				else                      //显示小心
				{
				    OLED_DrawBMP(22,10,63,24,HEARTBATE_LITTLE,sizeof(HEARTBATE_LITTLE),1);
					  flag = 0;
				}
		}
		else                         //采集结束显示
		{
		     /* 显示大心 */
			  OLED_DrawBMP(18,4,63,25,HEARTBATE_BIG,sizeof(HEARTBATE_BIG),1);
			
			  //显示数字
			  if( heart_num >= 100 )
				    OLED_ShowNum(21,30,heart_num,3,16);   	
				else if( heart_num >= 10	)
				    OLED_ShowNum(25,30,heart_num,2,16);   	
				else
			      OLED_ShowNum(29,30,heart_num,1,16);  
	
//				if( ++flag /*< 10*/ )
//				{
//				    //开始计算心率血氧值
//			      Get_Heart_Oxygen(0);
//					
//					  if( flag % 2 == 0 )
//						     OLED_ShowString(46,36,"bmp",12,1);		
//				}
//        else
				{
            OLED_ctrl.oled_off_key = 1;    //开启倒计时息屏
					  OLED_ShowString(46,36,"bmp",12,1);	
					
					  Save_heart_sensor_data.Heart = heart_num;
					  
					  if( flag != 0xFF )
						{
                /* 开启振动 */
				        Motor_Drive();
							  flag = 0xFF;
						}
					  timers_stop_Max30102_timer();            //关闭传感器数据采集
				}   				
		}
			
	  
    OLED_Refresh_Gram();   //刷新显示
}

/**********************************************************************
函数名:OLEDE_dispaly_Oxygen
功能:显示血氧
输入参数：
@oxygen:血氧
输出参数:None
返回值:None
说明:
***********************************************************************/
void OLEDE_dispaly_Oxygen(s16 oxygen)
{	
    static uint8_t flag = 0;      //控制图标闪烁
	
    OLED_Clear();    
    if( oxygen < 0 )           //准备开始采集
		{
		    /* 显示图标 */
			  OLED_DrawBMP(18,1,63,31,OXYGEN_1,sizeof(OXYGEN_1),1);
			  OLED_ShowNum(29,33,abs(oxygen),1,12); 
			
			  if( abs(oxygen) <= 2 )     //从倒计时2S时开始采集数据
				{
					  flag = 0;
			      //开始计算心率血氧值
			      Get_Heart_Oxygen(1);
				}
		}
		else if( oxygen == 0 )     //采集中
		{
			   //开始计算心率血氧值
			   Get_Heart_Oxygen(0);	
			
		    if( flag == 0 )           //显示图标
				{
				    OLED_DrawBMP(18,1,63,31,OXYGEN_1,sizeof(OXYGEN_1),1);
					  flag = 1;
				}
				else                      //不显示
				{
					  OLED_DrawBMP(18,1,63,31,OXYGEN_2,sizeof(OXYGEN_2),1);
					  flag = 0;
				}
		}
		else                         //采集结束显示
		{		
		     /* 显示图标 */
			  OLED_DrawBMP(18,1,63,31,OXYGEN_1,sizeof(OXYGEN_1),1);
			  char buff[10] = {0};
			  sprintf(buff,"%d %%",oxygen);
	
	      if( oxygen >= 100 )
		        OLED_ShowString(20,32,buff,16,1);	
		    else
					  OLED_ShowString(24,32,buff,16,1);	
//				
//			  if( ++flag < 5 )
//				{
//				    //开始计算心率血氧值
//			      Get_Heart_Oxygen(0);
//				}
//        else
//				{
            OLED_ctrl.oled_off_key = 1;    //开启倒计时息屏 

            Save_heart_sensor_data.SpO2 = oxygen;				
					 
				    if( flag != 0xFF )
						{
				        /* 开启振动 */
				        Motor_Drive();
							  flag = 0xFF;
						}
					  timers_stop_Max30102_timer();            //关闭传感器数据采集
//				}					
		}
			
	  
    OLED_Refresh_Gram();   //刷新显示
}

/**********************************************************************
函数名:OLEDE_dispaly_Temperature
功能:显示温度
输入参数：
@oxygen:血氧
输出参数:None
返回值:None
说明:
***********************************************************************/
void OLEDE_dispaly_Temperature(s16 temp)
{	
	  static uint8_t flag = 0;      //控制采集的时间长度
	
    OLED_Clear();    
	
    if( temp < 0 )           //准备开始采集
		{
		    /* 显示图标 */
			   OLED_DrawBMP(18,1,63,31,TEMPER,sizeof(TEMPER),1);
			   OLED_ShowNum(29,33,abs(temp),1,12);
         flag = 0;			
		}
		else                         //采集结束显示
		{
			  MAX3010x_Get_DIETemp(NULL, NULL);
		     /* 显示图标 */
			  OLED_DrawBMP(18,1,63,31,TEMPER,sizeof(TEMPER),1);
			  char buff[10] = {0};
			  sprintf(buff,"%d.%d",temp/10,temp%10);
	
	      if( temp >= 100 )
		        OLED_ShowString(14,32,buff,16,1);	
		    else
					  OLED_ShowString(23,32,buff,16,1);	
				
				//显示单位
				 OLED_DrawBMP(46,32,63,48,DEGREE,sizeof(DEGREE),1);
				
				//采集温度30S
				if( ++flag >= 30 )
				{
					  flag = 0;
				    OLED_ctrl.oled_off_key = 1;    //开启倒计时息屏
					   
					  Save_heart_sensor_data.Temper = temp;
					
					  if( flag != 0xFF )
						{
					      /* 开启振动 */
				        Motor_Drive();
							  flag = 0xFF;
						}
					  timers_stop_Max30102_timer();            //关闭传感器数据采集
				}					
		}
			
    OLED_Refresh_Gram();   //刷新显示
}

/**********************************************************************
函数名:OLEDE_dispaly_alarm
功能:显示闹钟
输入参数:None
输出参数:None
返回值:None
说明:
***********************************************************************/
void OLEDE_dispaly_alarm(void)
{	
    OLED_Clear();    
    OLED_DrawBMP(12,5,63,43,ALARM,sizeof(ALARM),1);
    OLED_Refresh_Gram();   //刷新显示
}

/**********************************************************************
函数名:OLEDE_dispaly_mac
功能:显示MAC
输入参数:None
输出参数:None
返回值:None
说明:
high < 0,表示心率采集准备，倒计时
high = 0,表示正在采集
***********************************************************************/
void OLEDE_dispaly_mac(void)
{
     char buff[2][9] = {0};
	 
     ble_gap_addr_t device_addr;

	   OLED_Clear();
	   
	   sd_ble_gap_addr_get(&device_addr);
     memset(buff,0,sizeof(buff));
	   sprintf(buff[0],"%02X:%02X:%02X",device_addr.addr[5],device_addr.addr[4],device_addr.addr[3]);
	   sprintf(buff[1],"%02X:%02X:%02X",device_addr.addr[2],device_addr.addr[1],device_addr.addr[0]);

     OLED_DrawBMP(18,2,63,18,M,sizeof(M),1);
		 OLED_DrawBMP(30,2,63,18,A,sizeof(A),1);
		 OLED_DrawBMP(41,2,63,18,C,sizeof(C),1);
     OLED_ShowString(10,18,&buff[0][0],12,1);
	   OLED_ShowString(10,28,&buff[1][0],12,1);

	   OLED_Refresh_Gram();   //刷新显示
}


/**********************************************************************
函数名:OLEDE_dispaly_Temperature
功能:显示温度
输入参数：
@oxygen:血氧
输出参数:None
返回值:None
说明:
***********************************************************************/
void OLEDE_dispaly_Phone_Collect(void)
{	
	  static uint8_t flag = 1;      //控制采集的时间长度
	
    OLED_Clear();   
    
	 if( flag == 1 )
	      OLED_DrawBMP(16,8,63,40,Collect_1,sizeof(Collect_1),1);
		else if( flag == 2 )
	      OLED_DrawBMP(16,8,63,40,Collect_2,sizeof(Collect_2),1);
		else if( flag == 3 )
	      OLED_DrawBMP(16,8,63,40,Collect_3,sizeof(Collect_3),1);
		
		if( ++flag >= 4 )
        flag = 1;			
		
		//开始计算心率血氧值
		Get_Heart_Oxygen(0);
		
		//采集温度
    MAX3010x_Get_DIETemp(NULL, NULL);
		
		uint8_t buff[5] = {0};
		max30102_data.Heart = 65;   //先给一个预设值，不然采集出来心率
		/* 将采集的数据发送到手机 */
		buff[0] = PRODUCT_NUMBER;
		buff[1] = CMD_Continuous_Collect;
		buff[2] = max30102_data.SpO2;
		buff[3] = max30102_data.Heart;
		buff[4] = max30102_data.Temper -200;
	 
	  BLE_Salve_SendData(buff,sizeof(buff));					
		
    OLED_Refresh_Gram();   //刷新显示
}

/**********************************************************************
函数名:OLEDE_dispaly_BLE_Connect
功能:显示蓝牙连接界面
输入参数：
@time:显示时间，为0时跳入之前的页面
输出参数:None
返回值:None
说明:
***********************************************************************/
void OLEDE_dispaly_BLE_Connect(int time)
{
    if( time == 0 )    //调回之前的页面
		{
			  if( OLED_ctrl.lastPageOledState == OLED_ON )    //如果前一个页面是屏是亮着的
            SetNewPageInfo(OLED_ctrl.lastPageNum, OLED_ctrl.lastPageOledState, OLED_ctrl.lastPageKey, OLED_OFF_TIME);	   
				else          //如果前一个页面是熄灭的
          	SetNewPageInfo(DATE_P, OLED_ON, OLED_CLOSE_EN, OLED_OFF_TIME);	 //显示日期					
		}	
		else{
		    OLED_Clear();    
        OLED_DrawBMP(16,8,48,40,BLE_Connect,sizeof(BLE_Connect),1);
        OLED_Refresh_Gram();   //刷新显示    
		}		
}

/**********************************************************************
函数名:OLEDE_dispaly_BLE_Disconnect
功能:显示蓝牙断开界面
输入参数：
输出参数:None
返回值:None
说明:
    1.蓝牙断开页面需要手动切换，或者倒计时时间到。且在显示的时候还需要震动。
    2.蓝牙断开后。如果是在手机采集页面，将自动停止。
***********************************************************************/
void OLEDE_dispaly_BLE_Disconnect(void)
{
	  static uint8_t flag = 0;
	
    OLED_Clear();    
    OLED_DrawBMP(16,8,48,40,BLE_Disconnect,sizeof(BLE_Disconnect),1);
    OLED_Refresh_Gram();   //刷新显示 

	  //如果上一个页面是在手机采集页面。断开连接后停止采集，回复到日期页面
	  if( OLED_ctrl.lastPageNum == COLLECT_P )
		{
			   SetLastPageInfo(DATE_P, OLED_ON, OLED_CLOSE_EN, OLED_OFF_TIME);	
			   timers_stop_Max30102_timer();    //关闭连续采集
		}
		
    if( flag == 0 )
		{
		    flag = 1;
			  Motor_Drive();
		}	
    else
		    flag = 0;
}

#ifdef BLE_SCAN
/**********************************************************************
函数名:OLEDE_dispaly_BeaconLost
功能:显示蓝牙信标丢失
输入参数：
输出参数:None
返回值:None
说明:
    蓝牙断开页面需要手动切换，或者倒计时时间到。且在显示的时候还需要震动。
***********************************************************************/
void OLEDE_dispaly_BeaconLost(void)
{
	  static uint8_t flag = 0;
	
    OLED_Clear();    
    OLED_DrawBMP(16,8,48,40,Beacon_lost,sizeof(Beacon_lost),1);
    OLED_Refresh_Gram();   //刷新显示 

    if( flag == 0 )
		{
		    flag = 1;
			  Motor_Drive();
		}	
    else
		    flag = 0;
}


#endif












